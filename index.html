<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ZIM - Code Creativity</title>

  <!-- Welcome to ZIM at https://zimjs.com - Code Creativity!                              -->
  <!-- ZIM runs on the HTML Canvas powered by JavaScript and CreateJS https://createjs.com -->
  <!-- ZIM is free to use. You can donate to help improve ZIM at https://zimjs.com/donate  -->

  <script src="https://zimjs.org/cdn/1.3.2/createjs.js"></script>
  <script src="https://zimjs.org/cdn/cat/03/zim.js"></script>
  <!-- use zimjs.com/distill for minified individual functions! -->

  <script src="https://zimjs.org/cdn/Box2dWeb-2.1.a.3.min.js"></script>
  <script src="https://zimjs.org/cdn/physics_2.1.js"></script>


  <script>

  // SCALING OPTIONS
  // scaling can have values as follows with full being the default
  // "fit"	sets canvas and stage to dimensions and scales to fit inside window size
  // "outside"	sets canvas and stage to dimensions and scales to fit outside window size
  // "full"	sets stage to window size with no scaling
  // "tagID"	add canvas to HTML tag of ID - set to dimensions if provided - no scaling

  const scaling = "fit"; // this will resize to fit inside the screen dimensions
  const width = 1024;
  const height = 768;
  const color = green; // ZIM colors like green, blue, pink, faint, clear, etc.
  const outerColor = dark; // any HTML colors like "violet", "#333", etc. are fine to use




  const frame = new Frame(scaling, width, height, color, outerColor);
  frame.on("ready", () => { // ES6 Arrow Function - like function(){}
    zog("ready from ZIM Frame"); // logs in console (F12 - choose console)

    const stage = frame.stage;
    let stageW = frame.width;
    let stageH = frame.height;

    // see https://zimjs.com/learn.html for video and code tutorials
    // see https://zimjs.com/docs.html for documentation
    // see https://zimjs.com/bits.html for 64 Interactive Media techniques

    // *** NOTE: ZIM Cat defaults to time in seconds
    // All previous versions, examples, videos, etc. have time in milliseconds
    // This can be set back with TIME = "milliseconds" but we suggest you give it a try!
    // There will be a warning in the conslole if your animation is not moving ;-)

    // put your code here (you can delete this sample code)


    const physics = new Physics(15);
    // physics.debug();

    const ball = new Circle(50,red)
    .pos(100, 0)
    // dynamic, contract, shape, friction, linear, angular,
    // density, bounciness, maskBits, categoryBits, physics
    .addPhysics({
      density:1,
	  linear: 0.85,
      bounciness:0.2
    });


    //when working with sound on the web you need to add a button or progress bar... that is the rule

	//const screen = new Rectangle(stageW, stageH, yellow).centerReg();

    button = new Button({
      label: new Label({
        text:"START",
        color:yellow,
        font:"OldStandardTT-Regular"}),
        backgroundColor:red,
        rollBackgroundColor:purple,
        corner:10
	}).centerReg().alp(0).animate({
        props:{alpha:1},

      }).tap(() => {
        button.removeFrom();
		//screen.removeFrom();
        startGame();
      });


      function startGame(){

        //soundwave allows u to use the mic
        var soundWave = new SoundWave({
          num:1, // I believe stands for frequency. We only need one freq (one sound) to trigger the ball
          input:"mic", // that you are using the comp mic
		  smoothing: 0.85,
		  min:-80, //this is the minimum volume point to let register sound coming from the mic
		  max:-50,
		  baseline:2,
          //magnify:5,
          include:0.117// I believe is what kind of frequencies to let pass. Its set to register low frequencies because we all create mostly low frequencies (its an acoustic phenomenon)
          // if you like, play around with those parameters and physics to get a better trigger effect
        });

        soundWave.on("ready", function(s) {

          Ticker.add(function() {
            // call the calculate() method of the soundWave
            var data = soundWave.calculate();

            //the frequency recorded by the mic will kick the ball up on the y axis. i believe because the frequency registration is set to low frequencies, the output number is around .01 to 0.1. This number is multiplied (by magnify) to move the ball up at a decent height
            ball.impulse(0, data*-0.1);
          })// end of ticker

        }); // end soundWave ready

        // you can move the ball left or right with the arrow keys
        frame.on("keydown", function (e) {
          if (e.keyCode == 37) {
            ball.impulse(-100,0);
          } else if (e.keyCode == 39) {
            ball.impulse(100,0);
          }
        });


		const platform1 = new Rectangle(240, 40, "blue").centerReg().pos(600, 500).addPhysics(false);

		const platform = new Rectangle(240, 40, "red").centerReg().pos(200, 300).addPhysics(false);


      };// end of function startGame


      stage.update(); // this is needed to show any changes

    }); // end of ready

    </script>

    <meta name="viewport" content="width=device-width, user-scalable=no" />

  </head>

  <body>
    <!-- canvas with id="myCanvas" is made by zim Frame -->
  </body>
  </html>
